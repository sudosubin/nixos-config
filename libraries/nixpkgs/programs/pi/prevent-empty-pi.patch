diff --git a/packages/coding-agent/src/core/settings-manager.ts b/packages/coding-agent/src/core/settings-manager.ts
index f6ac85e2..1ef236d9 100644
--- a/packages/coding-agent/src/core/settings-manager.ts
+++ b/packages/coding-agent/src/core/settings-manager.ts
@@ -144,10 +144,16 @@ export class FileSettingsStorage implements SettingsStorage {
 	withLock(scope: SettingsScope, fn: (current: string | undefined) => string | undefined): void {
 		const path = scope === "global" ? this.globalSettingsPath : this.projectSettingsPath;
 		const dir = dirname(path);
 		if (!existsSync(dir)) {
+			const next = fn(undefined);
+			if (next === undefined) {
+				return;
+			}
 			mkdirSync(dir, { recursive: true });
+			writeFileSync(path, next, "utf-8");
+			return;
 		}
 
 		let release: (() => void) | undefined;
 		try {
